---

layout: post

title: de Bruijn 수열

author: junis3

date: 2020-02-19

tags: []

---

## De Bruijn 수열

당신은, 친구에게 $1$에서 $K$까지의 수들을 나열한 원형 수열(끝 글자와 첫 글자가 이어지는 수열)을 선물로 받았다. 이 수열은 신기한 성질을 가지고 있다. 이 수열에서 길이 $N$인 연속한 부분수열들을 모두 나열한다. 물론 원형 수열이기 때문에 그런 수열의 개수는 수열의 길이와 같다. 이 때, 이렇게 모은 부분수열의 모음이 그러면 $1$에서 $K$까지의 수들로 만든 모든 길이 $N$의 수열의 모음과 같았다!

그런 수열을 De Bruijn('jin'이 아니라 'ijn'임에 유의하자. 드 브루인이라고 읽는다.) 수열이라 한다. 예를 들어 $K = 3$, $N = 2$인 De Bruijn 수열 $B(3, 2) = "112322133"$을 보자. 이 수열의 길이 N = 2인 부분수열의 개수는 수열의 길이와 같은 9개이다. 이들 $"11"$, $"12"$, $"23"$, $"32"$, $"22"$, $"21"$, $"13"$, $"33"$, $"31"$(마지막은 De Bruijn 수열이 원형 수열이기 때문에 등장했다!)를 모두 모으면 $1$에서 $K = 3$까지의 수들로 이루어진 길이 $N = 2$의 수열을 순서 없이 모두 얻을 수 있다. 마찬가지로, $B(2, 3) = "11121222"$, $B(2, 4) = "1111211221212222"$ 등을 만들어낼 수 있다. 등호를 사용하였지만 물론 De Brujin 수열이 유일하지는 않다. $B(2, 3) = "22212111"$도 가능한 선택지이다.

어떤 K와 N에 대한 De Brujin 수열 B(K, N)의 이상적인 최소 길이는, 모든 가능한 길이 N의 부분수열의 개수와 같은, $L = K^N$이다. 물론 그러기 위해서는 운이 정말 좋아 길이 N의 부분수열들이 하나도 겹치지 않고 한 번씩만 나타나야 할 것이다. 놀랍게도 항상 최적으로 수열을 만드는 것이 가능하다. 증명은 아래에서 이런 수열을 실제로 만드는 방법을 보일 때 저절로 이루어질 것이다. 심지어 그런 방법의 가짓수도 굉장히 많은데, 서로 다른 De Brujin 수열(돌려서 같은 것은 하나로 친다)의 개수는 아래와 같다:

$$\frac{(k!)^{k^{n-1}}}{k^n}$$

이제 우리의 주 관심사인, '어떻게 De Brujin 수열을 만들 것인가'에 대해 생각해 보자.

## De Bruijn 그래프

이 수열을 그래프로 그려보자. De Bruijn 그래프 $G(K, N) = (V, E)$는 다음과 같이 정의된다.

1. $S = \left\{1, \cdots, K\right\}$로 두면, $V = S^N$.
2. 정점 $v_1$에 대한 수열의 맨 앞에서 수 하나를 없애고 맨 뒤에서 수 하나를 추가해서 정점 $v_2$에 대한 수열을 만들 수 있다면, $v_1 \rightarrow v_2$로 간선을 긋는다. 즉, $E = \left\{ \left(\left(s_i \right)_{i=1..N}, \left(s_i \right)_{i=2..N+1} \right) : s_i \in S, 1 \le i \le N+1 \right\}$. 조금 더 깔끔하게, 각 간선 위에 $s_{N+1} \in S$를 적어두자.

[그림 1]: [https://en.wikipedia.org/wiki/De_Bruijn_graph](https://en.wikipedia.org/wiki/De_Bruijn_graph)에서 가져오기

De Brujin 그래프는,

- 정점이 $K^N$개이고 간선은 $K^{N+1}$개이다.
- $G(K, N)$은 $G(K, N-1)$의 line graph이다. 이 때, 어떤 그래프 $(V, E)$의 line graph란, $(E, \left\{ ((v_1, v_2), (v_2, v_3)) : (v_1, v_2), (v_2, v_3) \in E \right\}$이다. 이 사실은, De Brujin 그래프의 각 간선이 $(s_i)_{i=1..N+1}$에 대응됨을 생각해보면 매우 자연스럽다.
- 각 정점의 in-degree와 out-degree 모두 $K$이다. 따라서, 임의의 정점에서 시작하는 오일러 회로가 존재한다. 물론, De Brujin 그래프는 다른 De Brujin 그래프의 line graph이므로, 임의의 정점에서 시작하는 해밀턴 회로 또한 존재한다.

이 때, De Brujin 그래프 $G(K, N)$의 오일러 회로 하나를 그리자. 그리고, 회로 위의 각 간선에 적힌 수를 쭉 이어 적어보자. 이때, 회로 위의 연속된 $N$개의 간선에 적힌 수들은 회로의 끝 정점에 적힌 수열과 같다. 모든 정점을 한 번씩만 지나므로, 이 오일러 회로는 De Brujin 수열 $B(K, N)$에 대응된다. 오일러 회로를 찾는 Hierholzer 알고리즘은 간선의 개수에 대해 선형 시간에 작동하니, 우리는 De Bruijn 수열을 $O(K^{N+1}) = O(LK)$에 찾는 방법을 알아낸 것이다!

## 더 빠른 알고리즘

하지만 나이브하게 de Bruijn 그래프를 만드는 것은 굉장히 많은 메모리와 시간을 소모할 뿐더러, de Bruijn 수열을 만드는 도중에 멈출 수 없다는 문제가 있다. 그래프를 명시적으로 만드는 대신 정점을 나타내는 수열을 이용하여 암시적으로 만든 그래프에서 DFS를 수행하더라도 여전히 알고리즘은 매우 느린 시간에 작동한다. 이제, 목걸이와 Lyndon 단어라는 새로운 개념을 도입해, de Bruijn 수열을 가장 빠른 시간복잡도에 구할 수 있는 알고리즘을 소개한다. 이는 평균 $O(L)$의 시간복잡도에 작동한다.

아래 정의들에서, $K$를 고정한다. 따라서 사용할 수의 집합 $\left\{1, \cdots, K\right\}$도 고정된다. 이제 수열을 위 집합의 원소를 알파벳으로 하는 문자열로 보면, 문자열 $S$, $T$를 이어붙여 새로운 문자열 $ST$를 만들거나, 문자열 $S$를 $k$번 반복해 새로운 문자열 $S^k$를 만드는 연산을 그대로 할 수 있을 것이다. 또, $A = a_1 \cdots a_n$에 대해 $A_i = a_1 \cdots a_i$로 두자. 이제 우리가 알던 '사전순'의 개념을 여기서도 그대로 사용하자. 글자들 사이에는 글자를 나타내는 수의 대소관계를 그대로 적용시키기로 하고, $S < T$라는 것은 $S$가 $T$의 부분문자열이거나, $S = uav$, $T = ubw$이고 $a<b$를 만족하는 두 글자 $a$, $b$와 세 문자열 $u$, $v$, $w$가 존재한다는 것이라 하자.

정의 1.  문자열 $S=s_1 \cdots s_n$에 대해, $S$를 돌려서 만든 문자열 $S' = s_i s_{i+1} \cdots s_n s_1 \cdots s_{i-1}$ ($1 < i \le n$)이 항상 $S < S'$를 만족한다면, 즉 $S$를 돌려서 만든 문자열들의 집합에서 $S$가 사전순으로 제일 작은 단어일 때에 $S$를 목걸이(necklace)라고 한다. (사실은, $S$의 첫 글자와 끝 글자를 이은 목걸이 형태의 문자열을 사전순으로 가장 작은 선형 문자열 $S$로 대응시킨 것이다.)

정리 1. $A = a_1 \cdots a_n$이 목걸이이고 $a_i < K$일 때, $A_{i-1} (a_i+1)$도 목걸이이다.

증명. $A_{i-1} (a_i + 1)$이 목걸이가 아니라면, 인덱스 $k$가 존재하여,

$$a_k \cdots a_{i-1} (a_i + 1) A_{k-1} < a_1 \cdots a_{i-1} (a_i - 1)$$

을 만족할 것이다. 하지만 $A$가 목걸이라는 점에서 $a_1 \cdots a_{j-k} \le a_k \cdots a_{j-1}$를 만족하므로, $a_{j-k+1} < a_i - 1$

정의 2. 문자열 $S$에 대해, $S$가 다른 문자열 $T$를 $k>1$번 반복해서 얻어지면, $S$가 주기적이라고 말한다. 그리고 이 때, $k$를 최대화하는 $T$를 $S$의 주기라고 하고, . 그러한 $T$와 $k$가 존재하지 않으면 $S$가 비주기적이라고 말한다.

정의 3. 비주기적인 목걸이를 Lyndon 단어라고 한다.

정리. $N$이 주어진다. 길이가 $N$의 약수인 Lyndon 단어를 모두 모아, 사전순으로 정렬해 이어붙이면 길이 $N$의 de Bruijn 수열을 얻을 수 있다.

증명:

위 정리를 이용하면 다음과 같이 de Bruijn 수열을 재귀적으로 쉽게 생성할 수 있다. 

## 참고문헌

- [https://en.wikipedia.org/wiki/De_Bruijn_sequence](https://en.wikipedia.org/wiki/De_Bruijn_sequence)
- H. Fredricksen and J. Maiorana, Necklaces of beads in k colors and k-ary de Bruijn sequences, Descrete Mathematics, 23 (1978) 207-210.
- Eduardo Moreno, On the theorem of Fredricksen and Maiorana about de Bruijn sequences, Advances in Applied Mathematics 33 (2004) 413-415.
